<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cloud Trade</title>
  <meta name="description" content="Stock Trading App Demo" />
  <style>
    :root {
      --bg: #0c0f17; --panel: #11162a; --panel-2: #0f1424; --text: #e8ebf0; --muted: #9aa3b2; --accent: #58a6ff;
      --success:#2ecc71; --warning:#f1c40f; --danger:#e74c3c; --radius: 14px; --shadow: 0 8px 28px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{margin:0;font:16px system-ui;background:radial-gradient(1200px 800px at 120% -10%, #1a2039, var(--bg));color:var(--text);}
    a{color:var(--accent);text-decoration:none}

    header{position:sticky;top:0;z-index:20;background:rgba(17,22,42,.75);backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,.08)}
    .container{max-width:1200px;margin:0 auto;padding:14px 18px}
    .row{display:flex;gap:12px;align-items:center}
    .brand{font-weight:700}
    .spacer{flex:1}

    .btn{border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.06);padding:8px 14px;border-radius:10px;cursor:pointer;color:var(--text)}
    .btn.primary{border-color:rgba(88,166,255,.65);background:rgba(88,166,255,.22)}

    main{padding:18px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .col-12{grid-column:span 12}
    @media (min-width:900px){.col-3{grid-column:span 3}.col-9{grid-column:span 9}}

    .card{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}

    .dash{display:grid;grid-template-columns:260px 1fr;gap:16px}
    .sidebar{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:12px;height:100%}
    .navlink{display:block;padding:10px 12px;border-radius:10px;margin-bottom:4px}
    .navlink:hover,.navlink.active{background:rgba(255,255,255,.06)}

    table{width:100%;border:1px solid rgba(255,255,255,.08);border-radius:12px;overflow:hidden;border-collapse:separate;border-spacing:0}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.06)}
    th{background:rgba(255,255,255,.08)}

    label{display:block;margin-top:10px}
    input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.25);background:#0f1529;color:var(--text)}
  </style>

  <script>
    window.API_BASE = "http://localhost:8000";
    window.POLY_PROXY_BASE = window.API_BASE + "/poly";
  </script>
</head>

<body>
<header>
  <div class="container row">
    <div class="brand">üìà Cloud Trade</div>
    <nav class="row">
      <a class="btn" href="#/login">Login</a>
      <a class="btn" href="#/signup">Sign Up</a>
      <a class="btn primary" href="#/summary">Dashboard</a>
    </nav>
    <div class="spacer"></div>
    <span id="online" style="font-size:.9em;color:var(--success)">‚óè Online</span>
  </div>
</header>

<main class="container"><div id="view" class="grid"></div></main>

<script>
/*************************
 * UTILITIES & STORAGE
 *************************/
const $=(s,r=document)=>r.querySelector(s);
const el=(t,a={},h='')=>Object.assign(document.createElement(t),a,h?{innerHTML:h}:{});

const store={
  get:k=>JSON.parse(localStorage.getItem(k)||"null"),
  set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))
};

/*************************
 * MARKET CONFIG
 *************************/
const DEFAULT_MARKET={
  open:"09:30",
  close:"16:00",
  holidays:["2025-01-01","2025-07-04"]
};
store.set("market",store.get("market")||DEFAULT_MARKET);

function isHoliday(date){
  return store.get("market").holidays.includes(date.toISOString().slice(0,10));
}
function isMarketOpen(){
  const m=store.get("market");
  const now=new Date();
  if(now.getDay()==0||now.getDay()==6)return false;
  if(isHoliday(now))return false;

  const [oH,oM]=m.open.split(":").map(Number);
  const [cH,cM]=m.close.split(":").map(Number);
  const open=new Date(now);open.setHours(oH,oM,0,0);
  const close=new Date(now);close.setHours(cH,cM,0,0);
  return now>=open&&now<=close;
}

/*************************
 * STOCK DATABASE
 *************************/
if(!store.get("stocks"))store.set("stocks",{});

function createStock(company,ticker,volume,price){
  const db=store.get("stocks");
  db[ticker.toUpperCase()]={
    company,ticker:ticker.toUpperCase(),
    volume:Number(volume),
    price:Number(price)
  };
  store.set("stocks",db);
}
function getStock(t){return store.get("stocks")[t.toUpperCase()]||null}

/*************************
 * ROUTER
 *************************/
const routes={};
function route(p,v){routes[p]=v}
async function render(){
  const hash=location.hash.replace("#","")||"/login";
  const view=routes[hash]||routes["/login"];
  $("#view").innerHTML="";
  $("#view").appendChild(await view());
}
addEventListener("hashchange",render);addEventListener("load",render);

/*************************
 * DASHBOARD LAYOUT
 *************************/
function dashboardShell(content){
  const wrap=el("div",{className:"col-12"});
  wrap.innerHTML=`
    <div class="dash">
      <nav class="sidebar">
        <a href="#/summary" class="navlink">Summary</a>
        <a href="#/trade" class="navlink">Trade</a>
        <a href="#/admin" class="navlink">Admin</a>
      </nav>
      <section>${content}</section>
    </div>`;
  return wrap;
}

/*************************
 * LOGIN
 *************************/
route("/login",async()=>{
  const wrap=el("div",{className:"col-12 col-9"});
  wrap.innerHTML=`
    <div class="card">
      <h2>Login</h2>
      <label>Username</label><input id="lu"/>
      <label>Password</label><input id="lp" type="password"/>
      <button class="btn primary" id="login-go">Sign In</button>
    </div>`;
  wrap.querySelector("#login-go").addEventListener("click",()=>location.hash="/summary");
  return wrap;
});

/*************************
 * SIGNUP
 *************************/
route("/signup",async()=>{
  const wrap=el("div",{className:"col-12 col-9"});
  wrap.innerHTML=`
    <div class="card">
      <h2>Create Account</h2>
      <label>Name</label><input id="sn"/>
      <label>Password</label><input id="sp" type="password"/>
      <button class="btn primary" id="sg">Sign Up</button>
    </div>`;
  wrap.querySelector("#sg").addEventListener("click",()=>{
    store.set("name",$("#sn").value);
    location.hash="/summary";
  });
  return wrap;
});

/*************************
 * SUMMARY
 *************************/
route("/summary",async()=>{
  return dashboardShell(`
    <div class="card">
      <h2>Account Summary</h2>
      <p>Welcome, ${store.get("name")||"Trader"}!</p>
    </div>
  `);
});

/*************************
 * TRADE
 *************************/
route("/trade",async()=>{
  const content=`
    <div class="grid">
      <div class="col-3">
        <div class="card">
          <h3>Search</h3>
          <input id="q" placeholder="AAPL"/>
          <button class="btn primary" id="search">Search</button>
        </div>
        <div class="card"><h3>Selected</h3><div id="sel">None</div></div>
      </div>
      <div class="col-9">
        <div class="card">
          <h3>Results</h3>
          <table><tbody id="results"></tbody></table>
        </div>
      </div>
    </div>`;
  
  const shell=dashboardShell(content);

  shell.querySelector("#search").addEventListener("click",()=>{
    const t=$("#q",shell).value.toUpperCase();
    const s=getStock(t);
    if(!s){$("#results",shell).innerHTML=`<tr><td>No such ticker.</td></tr>`;return;}

    $("#results",shell).innerHTML=`
      <tr>
        <td>${s.ticker}</td>
        <td>${s.company}</td>
        <td>$${s.price}</td>
        <td>
          <button class="btn" data-buy="${s.ticker}">Buy</button>
          <button class="btn" data-sell="${s.ticker}">Sell</button>
        </td>
      </tr>`;

    shell.querySelectorAll("[data-buy],[data-sell]").forEach(btn=>{
      btn.addEventListener("click",e=>{
        if(!isMarketOpen()){
          alert("‚ùå Market closed. Trades only allowed during open hours.");
          return;
        }
        alert("Trade executed.");
      });
    });
  });

  return shell;
});

/*************************
 * ADMIN
 *************************/
route("/admin",async()=>{
  const content=`
    <div class="card">
      <h2>Admin Panel</h2>

      <h3>Create Stock</h3>
      <label>Company</label><input id="co"/>
      <label>Ticker</label><input id="ti"/>
      <label>Volume</label><input id="vo" type="number"/>
      <label>Initial Price</label><input id="pr" type="number"/>
      <button class="btn primary" id="cs">Create</button>

      <hr/>

      <h3>Market Hours</h3>
      <label>Open</label><input id="mo" placeholder="09:30"/>
      <label>Close</label><input id="mc" placeholder="16:00"/>
      <label>Holidays (comma separated)</label>
      <input id="mh" placeholder="2025-01-01, 2025-07-04"/>
      <button class="btn primary" id="sm">Save Market</button>
    </div>`;

  const shell=dashboardShell(content);

  shell.querySelector("#cs").addEventListener("click",()=>{
    createStock($("#co",shell).value,$("#ti",shell).value,$("#vo",shell).value,$("#pr",shell).value);
    alert("Stock created!");
  });

  shell.querySelector("#sm").addEventListener("click",()=>{
    store.set("market",{
      open:$("#mo",shell).value||"09:30",
      close:$("#mc",shell).value||"16:00",
      holidays:$("#mh",shell).value.split(",").map(x=>x.trim())
    });
    alert("Market settings saved.");
  });

  return shell;
});

/*************************
 * ONLINE INDICATOR
 *************************/
function updateOnline(){
  $("#online").textContent = navigator.onLine?"‚óè Online":"‚óè Offline";
  $("#online").style.color = navigator.onLine?"var(--success)":"var(--danger)";
}
addEventListener("online",updateOnline);
addEventListener("offline",updateOnline);
updateOnline();
</script>

</body>
</html>
